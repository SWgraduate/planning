<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HY-Compass (v4.0) - App</title>
    <!-- Tailwind CSS 로드 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide 아이콘 로드 -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --primary-color: #003c71; /* 한양대 메인 컬러 */
            --secondary-color: #77a6d4;
        }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: #f0f2f5;
        }
        /* 앱 전체를 감싸는 컨테이너 */
        .app-container {
            max-width: 450px;
            height: 100vh;
            margin: 0 auto;
            background-color: white;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            position: relative; /* 챗봇 오버레이의 기준점 */
        }
        /* 앱 헤더 */
        .app-header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 1.25rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }
        .app-header h1 {
            font-size: 1.25rem;
            font-weight: 700;
        }
        /* 메인 콘텐츠 영역 (스크롤) */
        .app-content {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1.5rem;
        }
        .page {
            display: none; /* 페이지는 기본적으로 숨김 */
        }
        .page.active {
            display: block; /* active 클래스가 있는 페이지만 표시 */
        }
        /* 하단 네비게이션 */
        .app-nav {
            display: flex;
            background-color: #ffffff;
            border-top: 1px solid #e5e7eb;
            flex-shrink: 0;
            width: 100%;
            height: 64px;
            padding: 0;
            margin: 0;
        }
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 0;
            cursor: pointer;
            color: #9ca3af; /* 비활성 아이콘 색상 */
            transition: color 0.2s;
            min-width: 0;
            text-align: center;
        }
        .nav-item i {
            width: 1.5rem;
            height: 1.5rem;
            margin-bottom: 0.25rem;
            flex-shrink: 0;
            stroke-width: 2;
            color: inherit;
        }
        .nav-item.active {
            color: var(--primary-color); /* 활성 아이콘 색상 */
        }
        .nav-item.active i {
            color: var(--primary-color);
        }
        .nav-item span {
            display: block;
            font-size: 0.7rem;
            line-height: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        /* 공통 카드 스타일 */
        .card {
            background-color: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        /* 버튼 스타일 최적화 */
        button {
            min-height: 44px;
            transition: all 0.2s;
            cursor: pointer;
            border: none;
            outline: none;
        }
        button:active {
            transform: scale(0.98);
            opacity: 0.8;
        }
        
        /* 입력 필드 스타일 */
        input[type="text"] {
            min-height: 44px;
            padding: 0.75rem 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: border-color 0.2s;
        }
        input[type="text"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 60, 113, 0.1);
        }
        .card-title {
            font-size: 1.15rem;
            font-weight: 700;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        /* 플로팅 챗봇 버튼 */
        .fab-chatbot {
            position: absolute;
            bottom: 5.5rem; /* 하단 탭 높이 위 */
            right: 1.5rem;
            width: 3.5rem;
            height: 3.5rem;
            background-color: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0, 50, 100, 0.2);
            cursor: pointer;
            z-index: 100;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .fab-chatbot:active {
            transform: scale(0.95);
            box-shadow: 0 2px 8px rgba(0, 50, 100, 0.3);
        }
        .fab-chatbot i {
            color: white;
            width: 1.5rem;
            height: 1.5rem;
        }
        /* 챗봇 오버레이 - 앱 컨테이너 안에서 페이지처럼 표시 */
        .chatbot-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 200;
            display: none;
            flex-direction: column;
            overflow: hidden;
        }
        .chatbot-overlay.show {
            display: flex;
        }
        .chat-bubble {
            padding: 0.75rem 1rem;
            border-radius: 1.25rem;
            margin-bottom: 0.75rem;
            max-width: 80%;
            font-size: 0.95rem;
        }
        .bot-bubble {
            background-color: #f3f4f6;
            align-self: flex-start;
            border-bottom-left-radius: 0.5rem;
        }
        .user-bubble {
            background-color: var(--primary-color);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 0.5rem;
        }
        
        /* 1. 캠퍼스맵 핀 스타일 */
        .map-pin {
            position: absolute;
            width: 2.5rem; /* 모바일에 맞게 약간 축소 */
            height: 2.5rem;
            background-color: var(--primary-color);
            border-radius: 50% 50% 50% 0;
            transform: rotate(-45deg);
            border: 2px solid white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        .map-pin i {
            transform: rotate(45deg);
            color: white;
            width: 1rem;
            height: 1rem;
        }
        .map-pin:hover {
            transform: rotate(-45deg) scale(1.1);
        }
        .pin-tooltip {
            position: absolute;
            bottom: 120%;
            left: 50%;
            transform: translateX(-50%) rotate(45deg);
            background-color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--primary-color);
            white-space: nowrap;
            display: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .map-pin:hover .pin-tooltip {
            display: block;
        }

        /* 3. 통화 시뮬레이션 오버레이 스타일 */
        .call-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #ffffff;
            z-index: 1000;
            display: none; /* 기본 숨김 */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            text-align: center;
        }
        .call-status {
            font-size: 1.1rem;
            color: var(--text-light-color);
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- 
          App Header (모든 페이지 공통)
        -->
        <header class="app-header">
            <h1 id="page-title" class="text-xl font-bold">홈</h1>
            <i data-lucide="bell"></i>
        </header>

        <!-- 
          App Content (페이지 전환 영역)
        -->
        <main class="app-content">
            <!-- 
              =====================================
              PAGE 1: 홈 (대시보드)
              =====================================
            -->
            <section id="home-page" class="page active">
                <div class="card bg-gradient-to-r from-blue-800 to-blue-600 text-white">
                    <h2 class="text-xl font-bold">김한양님, 안녕하세요!</h2>
                    <p class="mt-2 opacity-90">당신의 성공적인 캠퍼스 라이프를 응원합니다.</p>
                </div>
                
                <div class="card">
                    <h2 class="card-title"><i data-lucide="graduation-cap" class="mr-2"></i>My Academic GPS</h2>
                    <p class="text-sm text-gray-600 mb-2">졸업까지 <b>32학점</b> 남았습니다.</p>
                    <div class="w-full bg-gray-200 rounded-full h-4">
                        <div class="bg-blue-600 h-4 rounded-full" style="width: 75%"></div>
                    </div>
                    <div class="text-right text-sm font-semibold mt-1">98 / 130 학점</div>
                    <button onclick="goToPage('academics-page')" class="w-full mt-4 text-center bg-blue-50 text-blue-700 font-semibold py-2 rounded-lg">
                        자세히 보기
                    </button>
                </div>

                <div class="card">
                    <h2 class="card-title"><i data-lucide="map" class="mr-2"></i>Live Campus</h2>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div>
                                <p class="font-semibold">오늘의 학식 (학생식당)</p>
                                <p class="text-sm text-gray-600">제육덮밥, 치즈돈까스</p>
                            </div>
                            <i data-lucide="chevron-right" class="text-gray-400"></i>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div>
                                <p class="font-semibold">주요 행사</p>
                                <p class="text-sm text-gray-600">AI 명사 초청 특강 (제5공학관)</p>
                            </div>
                            <i data-lucide="chevron-right" class="text-gray-400"></i>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2 class="card-title"><i data-lucide="messages-square" class="mr-2"></i>Connect Hub 실시간 인기글</h2>
                    <div class="space-y-3">
                        <p class="p-2 bg-gray-50 rounded-lg text-sm truncate">컴퓨터네트워크 과목 팀플 구합니다 (3/5)</p>
                        <p class="p-2 bg-gray-50 rounded-lg text-sm truncate">운영체제 강의평가 어떤가요?</p>
                    </div>
                </div>
            </section>

            <!-- 
              =====================================
              PAGE 2: 학사 (졸업사정 로드맵)
              =====================================
            -->
            <section id="academics-page" class="page">
                <div class="card text-center">
                    <h2 class="card-title justify-center"><i data-lucide="graduation-cap" class="mr-2"></i>졸업 사정 현황</h2>
                    <div class="relative w-40 h-40 mx-auto">
                        <svg class="w-full h-full" viewBox="0 0 36 36">
                            <path d="M18 2.0845
                                  a 15.9155 15.9155 0 0 1 0 31.831
                                  a 15.9155 15.9155 0 0 1 0 -31.831"
                                  fill="none" stroke="#e6e6e6" stroke-width="3"/>
                            <path d="M18 2.0845
                                  a 15.9155 15.9155 0 0 1 0 31.831
                                  a 15.9155 15.9155 0 0 1 0 -31.831"
                                  fill="none" stroke="#003c71" stroke-width="3"
                                  stroke-dasharray="75, 100" stroke-linecap="round"/>
                        </svg>
                        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2">
                            <span class="text-3xl font-bold text-blue-800">75%</span>
                            <span class="block text-sm text-gray-500">98/130</span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3 class="font-bold text-lg mb-4">필수 이수 요건</h3>
                    <div>
                        <div class="border-b">
                            <button class="w-full flex justify-between items-center py-3">
                                <span class="font-semibold">전공 핵심 (2/3)</span>
                                <i data-lucide="chevron-down" class="w-5 h-5"></i>
                            </button>
                            <div class="pb-3 text-sm text-gray-600">
                                <p class="flex items-center"><i data-lucide="check" class="w-4 h-4 mr-2 text-green-500"></i> 자료구조</p>
                                <p class="flex items-center"><i data-lucide="check" class="w-4 h-4 mr-2 text-green-500"></i> 알고리즘</p>
                                <p class="flex items-center"><i data-lucide="x" class="w-4 h-4 mr-2 text-red-500"></i> 운영체제</p>
                            </div>
                        </div>
                        <div class="border-b">
                            <button class="w-full flex justify-between items-center py-3">
                                <span class="font-semibold">교양 필수 (4/4)</span>
                                <i data-lucide="chevron-down" class="w-5 h-5"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 
              =====================================
              PAGE 3: 커뮤니티 (Connect Hub)
              =====================================
            -->
            <section id="community-page" class="page">
                <div class="card">
                    <h2 class="card-title"><i data-lucide="book-open" class="mr-2"></i>강의평 / 정보</h2>
                    <div class="relative">
                        <input type="text" placeholder="강의명, 교수명 검색..." class="w-full pl-10 pr-4 py-2 border rounded-lg">
                        <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"></i>
                    </div>
                </div>

                <div class="card">
                    <h2 class="card-title"><i data-lucide="messages-square" class="mr-2"></i>게시판</h2>
                    <div class="space-y-2">
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg cursor-pointer">
                            <p class="font-semibold">자유게시판</p>
                            <i data-lucide="chevron-right" class="text-gray-400"></i>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg cursor-pointer">
                            <p class="font-semibold">스터디 / 팀플</p>
                            <i data-lucide="chevron-right" class="text-gray-400"></i>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg cursor-pointer">
                            <p class="font-semibold">Global Lounge (AI 번역)</p>
                            <i data-lucide="chevron-right" class="text-gray-400"></i>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 
              =====================================
              PAGE 4: 캠퍼스 (네비게이터) - * 1. 수정됨 *
              =====================================
            -->
            <section id="campus-page" class="page">
                <div class="card p-0 overflow-hidden">
                    <!-- 지도 영역: 핀을 올리기 위해 relative 설정 -->
                    <div id="map-container" class="relative">
                        <!-- 캠퍼스맵 이미지 -->
                        <img id="map-image" src="캠퍼스맵.png" alt="ERICA 캠퍼스맵" class="w-full h-auto object-cover">
                        <!-- 
                            '실시간 행사' 핀 컨테이너
                        -->
                        <div id="map-pins-container" class="absolute top-0 left-0 w-full h-full hidden">
                            <!-- 예시 핀 1: 제5공학관 -->
                            <div class="map-pin" style="top: 35%; left: 60%;">
                                <i data-lucide="code" class="w-4 h-4"></i>
                                <span class="pin-tooltip">AI 특강</span>
                            </div>
                            <!-- 예시 핀 2: 학생복지관 -->
                            <div class="map-pin" style="top: 25%; left: 30%;">
                                <i data-lucide="megaphone" class="w-4 h-4"></i>
                                <span class="pin-tooltip">동아리 박람회</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-4">
                        <!-- 버튼 그룹 -->
                        <div class="flex space-x-2 mb-4">
                            <button id="facilities-btn" onclick="toggleMapLayer('facilities')" class="flex-1 bg-blue-50 text-blue-700 py-2 rounded-lg text-sm font-semibold">
                                주요 시설
                            </button>
                            <button id="events-btn" onclick="toggleMapLayer('events')" class="flex-1 bg-gray-100 text-gray-700 py-2 rounded-lg text-sm font-semibold">
                                실시간 행사
                            </button>
                        </div>
                        
                        <!-- '주요 시설' 컴포넌트 -->
                        <div id="facilities-list-container">
                            <h3 class="font-bold mb-3">주요 시설</h3>
                            <!-- 검색창 -->
                            <div class="mb-3 flex space-x-2">
                                <input type="text" id="facilities-search-input" placeholder="시설명 검색 (예: 1공학관, 도서관)" 
                                       class="flex-1 border rounded-lg px-3 py-2 text-sm">
                                <button onclick="searchFacilities()" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold text-sm flex items-center">
                                    <i data-lucide="search" class="w-4 h-4"></i>
                                </button>
                            </div>
                            <!-- 시설 목록 -->
                            <div id="facilities-list" class="space-y-2">
                                <div class="facility-item p-3 bg-gray-50 rounded-lg" data-name="제1학술관" data-keywords="도서관 제1학술관 library">
                                    <p class="font-semibold text-sm">도서관 (제1학술관)</p>
                                    <p class="text-xs text-gray-600 mt-1">열람실 <b>82</b>/200석 (운영 중)</p>
                                </div>
                                <div class="facility-item p-3 bg-gray-50 rounded-lg" data-name="학생복지관" data-keywords="학생식당 복지관 편의점 cafeteria">
                                    <p class="font-semibold text-sm">학생식당 (복지관 1층)</p>
                                    <p class="text-xs text-gray-600 mt-1">운영 중 (11:00 ~ 18:00)</p>
                                </div>
                                <div class="facility-item p-3 bg-gray-50 rounded-lg" data-name="제1공학관" data-keywords="1공학관 제1공학관 기계공학 산업공학">
                                    <p class="font-semibold text-sm">제1공학관</p>
                                    <p class="text-xs text-gray-600 mt-1">기계공학과, 산업공학과</p>
                                </div>
                                <div class="facility-item p-3 bg-gray-50 rounded-lg" data-name="제2공학관" data-keywords="2공학관 제2공학관 건축공학 토목공학">
                                    <p class="font-semibold text-sm">제2공학관</p>
                                    <p class="text-xs text-gray-600 mt-1">건축공학과, 토목공학과</p>
                                </div>
                                <div class="facility-item p-3 bg-gray-50 rounded-lg" data-name="제3공학관" data-keywords="3공학관 제3공학관 화학공학 신소재공학">
                                    <p class="font-semibold text-sm">제3공학관</p>
                                    <p class="text-xs text-gray-600 mt-1">화학공학과, 신소재공학과</p>
                                </div>
                                <div class="facility-item p-3 bg-gray-50 rounded-lg" data-name="제4공학관" data-keywords="4공학관 제4공학관 전기공학 의용생체공학">
                                    <p class="font-semibold text-sm">제4공학관</p>
                                    <p class="text-xs text-gray-600 mt-1">전기공학과, 의용생체공학과</p>
                                </div>
                                <div class="facility-item p-3 bg-gray-50 rounded-lg" data-name="제5공학관" data-keywords="5공학관 제5공학관 컴퓨터공학 전자공학">
                                    <p class="font-semibold text-sm">제5공학관</p>
                                    <p class="text-xs text-gray-600 mt-1">컴퓨터공학과, 전자공학부</p>
                                </div>
                                <div class="facility-item p-3 bg-gray-50 rounded-lg" data-name="학연산클러스터" data-keywords="학연산 클러스터 창업지원센터">
                                    <p class="font-semibold text-sm">학연산클러스터</p>
                                    <p class="text-xs text-gray-600 mt-1">창업지원센터, 연구실</p>
                                </div>
                                <div class="facility-item p-3 bg-gray-50 rounded-lg" data-name="체육관" data-keywords="체육관 gym 운동시설">
                                    <p class="font-semibold text-sm">체육관</p>
                                    <p class="text-xs text-gray-600 mt-1">운동시설, 헬스장 (운영 중)</p>
                                </div>
                                <div class="facility-item p-3 bg-gray-50 rounded-lg" data-name="기숙사" data-keywords="기숙사 dormitory">
                                    <p class="font-semibold text-sm">학생기숙사</p>
                                    <p class="text-xs text-gray-600 mt-1">입주 학생 거주 시설</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- '실시간 행사' 컴포넌트 -->
                        <div id="event-list-container" class="hidden">
                            <h3 class="font-bold mb-3">실시간 행사</h3>
                            <!-- 검색창 -->
                            <div class="mb-3 flex space-x-2">
                                <input type="text" id="events-search-input" placeholder="행사명 검색 (예: AI 특강, 동아리)" 
                                       class="flex-1 border rounded-lg px-3 py-2 text-sm">
                                <button onclick="searchEvents()" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold text-sm flex items-center">
                                    <i data-lucide="search" class="w-4 h-4"></i>
                                </button>
                            </div>
                            <!-- 행사 목록 -->
                            <div id="events-list" class="space-y-2">
                                <div class="event-item p-3 bg-blue-50 rounded-lg" data-name="AI 명사 초청 특강" data-keywords="AI 특강 제5공학관 컴퓨터공학">
                                    <p class="font-semibold text-sm">AI 명사 초청 특강</p>
                                    <p class="text-xs text-gray-600 mt-1">제5공학관 101호 / 14:00 ~ 16:00</p>
                                </div>
                                <div class="event-item p-3 bg-gray-50 rounded-lg" data-name="동아리 박람회" data-keywords="동아리 박람회 복지관">
                                    <p class="font-semibold text-sm">동아리 박람회</p>
                                    <p class="text-xs text-gray-600 mt-1">학생복지관 앞 광장 / 11:00 ~ 17:00</p>
                                </div>
                                <div class="event-item p-3 bg-gray-50 rounded-lg" data-name="창업경진대회 설명회" data-keywords="창업 경진대회 학연산클러스터">
                                    <p class="font-semibold text-sm">창업경진대회 설명회</p>
                                    <p class="text-xs text-gray-600 mt-1">학연산클러스터 1층 / 18:00 ~ 19:00</p>
                                </div>
                                <div class="event-item p-3 bg-gray-50 rounded-lg" data-name="기계공학 세미나" data-keywords="기계공학 세미나 제1공학관">
                                    <p class="font-semibold text-sm">기계공학 세미나</p>
                                    <p class="text-xs text-gray-600 mt-1">제1공학관 201호 / 15:00 ~ 16:30</p>
                                </div>
                                <div class="event-item p-3 bg-gray-50 rounded-lg" data-name="건축설계 작품전시" data-keywords="건축 설계 전시 제2공학관">
                                    <p class="font-semibold text-sm">건축설계 작품전시</p>
                                    <p class="text-xs text-gray-600 mt-1">제2공학관 1층 로비 / 10:00 ~ 18:00</p>
                                </div>
                                <div class="event-item p-3 bg-gray-50 rounded-lg" data-name="화학공학 실험실 투어" data-keywords="화학공학 실험실 제3공학관">
                                    <p class="font-semibold text-sm">화학공학 실험실 투어</p>
                                    <p class="text-xs text-gray-600 mt-1">제3공학관 301호 / 13:00 ~ 14:00</p>
                                </div>
                                <div class="event-item p-3 bg-gray-50 rounded-lg" data-name="전기공학 학회" data-keywords="전기공학 학회 제4공학관">
                                    <p class="font-semibold text-sm">전기공학 학회</p>
                                    <p class="text-xs text-gray-600 mt-1">제4공학관 401호 / 16:00 ~ 17:30</p>
                                </div>
                                <div class="event-item p-3 bg-gray-50 rounded-lg" data-name="체육관 오픈데이" data-keywords="체육관 오픈데이 운동">
                                    <p class="font-semibold text-sm">체육관 오픈데이</p>
                                    <p class="text-xs text-gray-600 mt-1">체육관 / 09:00 ~ 21:00</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- 
              =====================================
              PAGE 5: 설정 및 마이페이지 (2. 추가됨)
              =====================================
            -->
            <section id="my-page" class="page">
                <div class="card mb-6">
                    <h2 class="card-title"><i data-lucide="user" class="mr-2"></i>내 정보</h2>
                    <div class="flex items-center">
                        <img src="https://placehold.co/80x80/77a6d4/FFF?text=HY" alt="Profile" class="rounded-full">
                        <div class="ml-4">
                            <p class="text-xl font-semibold">김한양</p>
                            <p class="text-sm text-gray-600">컴퓨터공학과 / 2022000123</p>
                            <button class="mt-1 text-xs text-blue-600 hover:underline">프로필 수정</button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2 class="card-title"><i data-lucide="settings" class="mr-2"></i>시스템 설정</h2>
                    
                    <h3 class="font-semibold text-lg mb-3">언어 설정 (Language)</h3>
                    <div class="flex space-x-2">
                        <button class="flex-1 bg-blue-50 text-blue-700 py-2 rounded-lg font-semibold text-sm">한국어</button>
                        <button class="flex-1 bg-gray-100 text-gray-700 py-2 rounded-lg font-semibold text-sm">English</button>
                        <button class="flex-1 bg-gray-100 text-gray-700 py-2 rounded-lg font-semibold text-sm">中文</button>
                    </div>

                    <h3 class="font-semibold text-lg mt-6 mb-3">알림 설정</h3>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <label for="noti1" class="font-medium">학사 일정 알림</label>
                            <input type="checkbox" id="noti1" class="form-checkbox h-5 w-5 text-blue-600" checked>
                        </div>
                        <div class="flex items-center justify-between">
                            <label for="noti2" class="font-medium">커뮤니티 키워드 알림</label>
                            <input type="checkbox" id="noti2" class="form-checkbox h-5 w-5 text-blue-600">
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- 
          플로팅 챗봇 버튼
        -->
        <div onclick="toggleChatbot(true)" class="fab-chatbot">
            <i data-lucide="message-circle" class="text-white"></i>
        </div>

        <!-- 
          하단 네비게이션 (2. 5개 탭으로 수정)
        -->
        <nav class="app-nav">
            <div id="nav-home-page" class="nav-item active" onclick="goToPage('home-page')">
                <i data-lucide="home"></i>
                <span>홈</span>
            </div>
            <div id="nav-academics-page" class="nav-item" onclick="goToPage('academics-page')">
                <i data-lucide="graduation-cap"></i>
                <span>학사</span>
            </div>
            <div id="nav-community-page" class="nav-item" onclick="goToPage('community-page')">
                <i data-lucide="users"></i>
                <span>커뮤니티</span>
            </div>
            <div id="nav-campus-page" class="nav-item" onclick="goToPage('campus-page')">
                <i data-lucide="map-pin"></i>
                <span>캠퍼스</span>
            </div>
            <div id="nav-my-page" class="nav-item" onclick="goToPage('my-page')">
                <i data-lucide="user"></i>
                <span>마이페이지</span>
            </div>
        </nav>

        <!-- 
          =====================================
          챗봇 오버레이 (앱 컨테이너 내 페이지)
          =====================================
        -->
        <div id="chatbot-overlay" class="chatbot-overlay">
        <!-- 챗봇 헤더 -->
        <header class="app-header">
            <i data-lucide="x" class="cursor-pointer text-white w-6 h-6" onclick="toggleChatbot(false)"></i>
            <h1 class="text-xl font-bold">AI 캠퍼스 비서</h1>
            <!-- 음성봇 통화 버튼 -->
            <i id="start-call-btn" data-lucide="phone" class="cursor-pointer text-white w-6 h-6" onclick="toggleCall(true)"></i>
        </header>

        <!-- 챗봇 대화창 -->
        <div class="flex-1 overflow-y-auto p-4 flex flex-col space-y-2" style="min-height: 0;">
            <div class="chat-bubble bot-bubble">
                안녕하세요! 무엇을 도와드릴까요?<br>
                (예: "도서관 운영시간 알려줘", "증명서 발급 방법")
            </div>
            <div class="chat-bubble user-bubble">
                도서관 언제까지 열어?
            </div>
            <div class="chat-bubble bot-bubble">
                제1학술관(도서관)은 평일 기준 22:00까지 운영됩니다.
            </div>
        </div>
        
        <!-- 챗봇 입력창 -->
        <div class="p-4 border-t flex items-center space-x-2 bg-white flex-shrink-0">
            <input type="text" placeholder="메시지를 입력하세요..." class="flex-1 border rounded-full px-4 py-2">
            <button class="bg-blue-600 text-white p-3 rounded-full flex-shrink-0">
                <i data-lucide="send" class="w-5 h-5"></i>
            </button>
        </div>

        <!-- 3. 통화 시뮬레이션 오버레이 (추가됨) -->
        <div id="call-overlay" class="call-overlay">
            <i data-lucide="user-check" class="w-24 h-24 text-blue-700 mb-6"></i>
            <h2 class="text-2xl font-bold mb-2">AI 상담원</h2>
            <p id="call-status-text" class="text-lg text-gray-600 call-status">연결 중...</p>
            
            <button id="end-call-btn" onclick="toggleCall(false)" class="mt-12 bg-red-500 text-white font-semibold py-3 px-6 rounded-full flex items-center space-x-2">
                <i data-lucide="phone-off" class="w-5 h-5"></i>
                <span>통화 종료</span>
            </button>
        </div>
    </div>
    </div>


    <script>
        // Lucide 아이콘 로드
        lucide.createIcons();

        // 현재 페이지 상태 관리
        let currentPage = 'home-page';

        // 페이지 전환 함수
        function goToPage(pageId) {
            // 모든 페이지 숨기기
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // 모든 탭 비활성화
            document.querySelectorAll('.nav-item').forEach(nav => {
                nav.classList.remove('active');
            });

            // 요청된 페이지만 보이기
            document.getElementById(pageId).classList.add('active');

            // 요청된 탭만 활성화
            document.getElementById('nav-' + pageId).classList.add('active');

            // 페이지 제목 변경
            const titles = {
                'home-page': '홈',
                'academics-page': 'My 학사',
                'community-page': '커뮤니티',
                'campus-page': '캠퍼스',
                'my-page': '마이페이지' // 2. 제목 추가
            };
            document.getElementById('page-title').innerText = titles[pageId];
            
            // 네비게이션 아이콘 색상 업데이트
            document.querySelectorAll('.nav-item i').forEach(icon => {
                const navItem = icon.closest('.nav-item');
                if (navItem && navItem.classList.contains('active')) {
                    icon.style.color = 'var(--primary-color)';
                } else {
                    icon.style.color = '#9ca3af';
                }
            });
            
            currentPage = pageId;
        }

        // 챗봇 오버레이 토글 함수
        function toggleChatbot(show) {
            const chatbotOverlay = document.getElementById('chatbot-overlay');
            const fabButton = document.querySelector('.fab-chatbot');
            if (show) {
                chatbotOverlay.classList.add('show');
                if (fabButton) {
                    fabButton.style.display = 'none';
                }
            } else {
                chatbotOverlay.classList.remove('show');
                if (fabButton) {
                    fabButton.style.display = 'flex';
                }
                toggleCall(false); // 챗봇 창 닫을 때 통화 오버레이도 강제로 닫기
            }
        }

        // 1. 캠퍼스맵 토글 함수 (추가됨)
        function toggleMapLayer(layerName) {
            const facilitiesBtn = document.getElementById('facilities-btn');
            const eventsBtn = document.getElementById('events-btn');
            const facilitiesList = document.getElementById('facilities-list-container');
            const eventList = document.getElementById('event-list-container');
            const mapPins = document.getElementById('map-pins-container');

            if (layerName === 'events') {
                // 행사 버튼 활성화
                eventsBtn.classList.add('bg-blue-50', 'text-blue-700');
                eventsBtn.classList.remove('bg-gray-100', 'text-gray-700');
                // 시설 버튼 비활성화
                facilitiesBtn.classList.add('bg-gray-100', 'text-gray-700');
                facilitiesBtn.classList.remove('bg-blue-50', 'text-blue-700');
                
                // 컨텐츠 교체
                facilitiesList.classList.add('hidden');
                eventList.classList.remove('hidden');
                mapPins.classList.remove('hidden');
            } else { // 'facilities'
                // 시설 버튼 활성화
                facilitiesBtn.classList.add('bg-blue-50', 'text-blue-700');
                facilitiesBtn.classList.remove('bg-gray-100', 'text-gray-700');
                // 행사 버튼 비활성화
                eventsBtn.classList.add('bg-gray-100', 'text-gray-700');
                eventsBtn.classList.remove('bg-blue-50', 'text-blue-700');
                
                // 컨텐츠 교체
                facilitiesList.classList.remove('hidden');
                eventList.classList.add('hidden');
                mapPins.classList.add('hidden');
            }
        }

        // 3. 통화 시뮬레이션 함수 (추가됨)
        function toggleCall(show) {
            const callOverlay = document.getElementById('call-overlay');
            const callStatusText = document.getElementById('call-status-text');
            
            if (show) {
                callOverlay.style.display = 'flex';
                // 연결 중... 텍스트를 2초 후에 '통화 중'으로 변경하는 시뮬레이션
                callStatusText.innerText = "연결 중...";
                setTimeout(() => {
                    // 통화 오버레이가 여전히 열려있을 때만 텍스트 변경
                    if (callOverlay.style.display === 'flex') {
                        callStatusText.innerText = "통화 중 (00:01)";
                    }
                }, 2000);
            } else {
                callOverlay.style.display = 'none';
            }
        }
        
        // 주요 시설 검색 함수
        function searchFacilities() {
            const searchInput = document.getElementById('facilities-search-input');
            const searchTerm = searchInput.value.toLowerCase().trim();
            const facilityItems = document.querySelectorAll('.facility-item');

            if (searchTerm === '') {
                facilityItems.forEach(item => {
                    item.style.display = '';
                    item.style.backgroundColor = '';
                });
                const noResultsMsg = document.getElementById('no-facilities-results');
                if (noResultsMsg) {
                    noResultsMsg.remove();
                }
                return;
            }

            facilityItems.forEach(item => {
                const name = item.getAttribute('data-name').toLowerCase();
                const keywords = item.getAttribute('data-keywords').toLowerCase();
                const text = item.textContent.toLowerCase();

                if (name.includes(searchTerm) || keywords.includes(searchTerm) || text.includes(searchTerm)) {
                    item.style.display = '';
                    item.style.backgroundColor = '#dbeafe';
                } else {
                    item.style.display = 'none';
                    item.style.backgroundColor = '';
                }
            });

            const visibleItems = Array.from(facilityItems).filter(item => item.style.display !== 'none');
            let noResultsMsg = document.getElementById('no-facilities-results');
            if (visibleItems.length === 0) {
                if (!noResultsMsg) {
                    noResultsMsg = document.createElement('div');
                    noResultsMsg.id = 'no-facilities-results';
                    noResultsMsg.className = 'text-center py-6 text-gray-500 text-sm';
                    noResultsMsg.innerHTML = '<p>검색 결과가 없습니다.</p><p class="text-xs mt-1">다른 검색어를 시도해보세요.</p>';
                    document.getElementById('facilities-list').appendChild(noResultsMsg);
                }
            } else {
                if (noResultsMsg) {
                    noResultsMsg.remove();
                }
            }
        }

        // 실시간 행사 검색 함수
        function searchEvents() {
            const searchInput = document.getElementById('events-search-input');
            const searchTerm = searchInput.value.toLowerCase().trim();
            const eventItems = document.querySelectorAll('.event-item');

            if (searchTerm === '') {
                eventItems.forEach(item => {
                    item.style.display = '';
                    item.style.backgroundColor = '';
                });
                const noResultsMsg = document.getElementById('no-events-results');
                if (noResultsMsg) {
                    noResultsMsg.remove();
                }
                return;
            }

            eventItems.forEach(item => {
                const name = item.getAttribute('data-name').toLowerCase();
                const keywords = item.getAttribute('data-keywords').toLowerCase();
                const text = item.textContent.toLowerCase();

                if (name.includes(searchTerm) || keywords.includes(searchTerm) || text.includes(searchTerm)) {
                    item.style.display = '';
                    item.style.backgroundColor = '#dbeafe';
                } else {
                    item.style.display = 'none';
                    item.style.backgroundColor = '';
                }
            });

            const visibleItems = Array.from(eventItems).filter(item => item.style.display !== 'none');
            let noResultsMsg = document.getElementById('no-events-results');
            if (visibleItems.length === 0) {
                if (!noResultsMsg) {
                    noResultsMsg = document.createElement('div');
                    noResultsMsg.id = 'no-events-results';
                    noResultsMsg.className = 'text-center py-6 text-gray-500 text-sm';
                    noResultsMsg.innerHTML = '<p>검색 결과가 없습니다.</p><p class="text-xs mt-1">다른 검색어를 시도해보세요.</p>';
                    document.getElementById('events-list').appendChild(noResultsMsg);
                }
            } else {
                if (noResultsMsg) {
                    noResultsMsg.remove();
                }
            }
        }
        
        // 페이지 로드 시 기본 탭 활성화 및 이벤트 리스너 설정
        document.addEventListener('DOMContentLoaded', () => {
            toggleMapLayer('facilities');
            
            // Enter 키로 검색 가능하도록 이벤트 리스너 추가
            const facilitiesInput = document.getElementById('facilities-search-input');
            const eventsInput = document.getElementById('events-search-input');
            
            if (facilitiesInput) {
                facilitiesInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        searchFacilities();
                    }
                });
            }
            
            if (eventsInput) {
                eventsInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        searchEvents();
                    }
                });
            }
            
            // Lucide 아이콘 다시 로드 (네비게이션 포함)
            lucide.createIcons();
            
            // 네비게이션 아이콘 색상 설정
            document.querySelectorAll('.nav-item i').forEach(icon => {
                const navItem = icon.closest('.nav-item');
                if (navItem && navItem.classList.contains('active')) {
                    icon.style.color = 'var(--primary-color)';
                } else {
                    icon.style.color = '#9ca3af';
                }
            });
        });
    </script>
</body>
</html>
